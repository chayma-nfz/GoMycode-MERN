{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Admin\\\\Desktop\\\\Nouveau dossier (2)\\\\ECommerce-MERN\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Admin\\\\Desktop\\\\Nouveau dossier (2)\\\\ECommerce-MERN\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import DropIn from'braintree-web-drop-in-react';//https://www.npmjs.com/package/braintree-web-drop-in-react\nimport{processPayment,getBraintreeClientToken,createOrder}from'../../helpers/userFetch';import{isAuthenticated}from'../../helpers/authFetch';import{emptyCart}from'../../helpers/cart';var Checkout=function Checkout(_ref){var products=_ref.products,_ref$setRender=_ref.setRender,setRender=_ref$setRender===void 0?function(f){return f;}:_ref$setRender,_ref$render=_ref.render,render=_ref$render===void 0?undefined:_ref$render;var _useState=useState({loading:false,success:false,clientToken:null,error:'',instance:{},address:''}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var userId=isAuthenticated()&&isAuthenticated().user._id;var token=isAuthenticated()&&isAuthenticated().token;var getToken=function getToken(userId,token){getBraintreeClientToken(userId,token).then(function(data){if(data.error){setData(_objectSpread({},data,{error:data.error}));}else{setData({clientToken:data.clientToken});}});};useEffect(function(){getToken(userId,token);// eslint-disable-next-line\n},[]);var getTotal=function getTotal(){return products.reduce(function(currentValue,nextValue){return Math.round(currentValue+nextValue.count*nextValue.price);},0);};var showCheckout=function showCheckout(){return isAuthenticated()?React.createElement(\"div\",null,showDropIn()):React.createElement(Link,{to:\"/signin\"},React.createElement(\"button\",{className:\"btn btn-primary\"},\"Sign in here\"));};var buy=function buy(){setData({loading:true});// send the nonce to your server\n// nonce = data.instance.requestPaymentMethod()\nvar nonce;// eslint-disable-next-line\nvar getNonce=data.instance.requestPaymentMethod().then(function(res){// console.log(data);\nnonce=res.nonce;// once you have nonce (card type, card number) send nonce as 'paymentMethodNonce'\n// and also total to be charged\n// console.log(\n//     \"send nonce and total to process: \",\n//     nonce,\n//     getTotal(products)\n// );\nvar paymentData={paymentMethodNonce:nonce,amount:getTotal(products)};processPayment(userId,token,paymentData).then(function(response){// console.log(response);\nsetData(_objectSpread({},data,{success:response.success}));// create order\nvar createOrderData={products:products,transaction_id:response.transaction.id,amount:response.transaction.amount,address:data.address};createOrder(userId,token,createOrderData);// empty cart\nemptyCart(function(){setRender(!render);// re-render localstorage\nconsole.log('payment success and empty cart');setData({loading:false,success:true});});}).catch(function(error){console.log(error);setData({loading:false});});}).catch(function(error){// console.log(\"dropin error: \", error);\nsetData(_objectSpread({},data,{error:error.message}));});};var handleAddress=function handleAddress(e){setData(_objectSpread({},data,{address:e.target.value}));};var showDropIn=function showDropIn(){return React.createElement(\"div\",{onBlur:function onBlur(){return setData(_objectSpread({},data,{error:''}));},className:\"w-50 m-auto\"},data.clientToken!==null&&products.length>0?React.createElement(\"div\",null,React.createElement(\"div\",{className:\"form-group mb-3\"},React.createElement(\"label\",{className:\"text-muted\"},\"Delivery Address:\"),React.createElement(\"textarea\",{className:\"form-control\",placeholder:\"Enter here\",value:data.address,onChange:handleAddress})),React.createElement(DropIn,{options:{authorization:data.clientToken,paypal:{flow:'vault'}},onInstance:function onInstance(instance){return data.instance=instance;}}),React.createElement(\"button\",{onClick:buy,className:\"btn btn-success btn-block pt-2\"},\"Pay\")):null);};var showError=function showError(error){return React.createElement(\"div\",{className:\"alert alert-danger\",style:{display:error?'':'none'}},error);};var showSuccess=function showSuccess(success){return React.createElement(\"div\",{className:\"alert alert-info\",style:{display:success?'':'none'}},\"Thanks! Your payment was successful!\");};var showLoading=function showLoading(loading){return loading&&React.createElement(\"div\",{className:\"d-flex justify-content-center\"},React.createElement(\"div\",{className:\"spinner-border\",role:\"status\"},React.createElement(\"span\",{className:\"sr-only\"},\"Loading...\")));};return React.createElement(\"div\",{className:\"container-fluid \"},React.createElement(\"h2\",null,\"Total: $\",getTotal()),showLoading(data.loading),showSuccess(data.success),showError(data.error),showCheckout());};export default Checkout;","map":{"version":3,"sources":["C:/Users/Admin/Desktop/Nouveau dossier (2)/ECommerce-MERN/client/src/components/Cart/Checkout.js"],"names":["React","useState","useEffect","Link","DropIn","processPayment","getBraintreeClientToken","createOrder","isAuthenticated","emptyCart","Checkout","products","setRender","f","render","undefined","loading","success","clientToken","error","instance","address","data","setData","userId","user","_id","token","getToken","then","getTotal","reduce","currentValue","nextValue","Math","round","count","price","showCheckout","showDropIn","buy","nonce","getNonce","requestPaymentMethod","res","paymentData","paymentMethodNonce","amount","response","createOrderData","transaction_id","transaction","id","console","log","catch","message","handleAddress","e","target","value","length","authorization","paypal","flow","showError","display","showSuccess","showLoading"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport DropIn from 'braintree-web-drop-in-react'; //https://www.npmjs.com/package/braintree-web-drop-in-react\nimport {\n  processPayment,\n  getBraintreeClientToken,\n  createOrder\n} from '../../helpers/userFetch';\nimport { isAuthenticated } from '../../helpers/authFetch';\nimport { emptyCart } from '../../helpers/cart';\n\nconst Checkout = ({ products, setRender = f => f, render = undefined }) => {\n  const [data, setData] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: '',\n    instance: {},\n    address: ''\n  });\n\n  const userId = isAuthenticated() && isAuthenticated().user._id;\n  const token = isAuthenticated() && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getBraintreeClientToken(userId, token).then(data => {\n      if (data.error) {\n        setData({ ...data, error: data.error });\n      } else {\n        setData({ clientToken: data.clientToken });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n    // eslint-disable-next-line\n  }, []);\n\n  const getTotal = () => {\n    return products.reduce((currentValue, nextValue) => {\n      return Math.round(currentValue + nextValue.count * nextValue.price);\n    }, 0);\n  };\n\n  const showCheckout = () => {\n    return isAuthenticated() ? (\n      <div>{showDropIn()}</div>\n    ) : (\n      <Link to=\"/signin\">\n        <button className=\"btn btn-primary\">Sign in here</button>\n      </Link>\n    );\n  };\n\n  const buy = () => {\n    setData({ loading: true });\n    // send the nonce to your server\n    // nonce = data.instance.requestPaymentMethod()\n    let nonce;\n    // eslint-disable-next-line\n    let getNonce = data.instance\n      .requestPaymentMethod()\n      .then(res => {\n        // console.log(data);\n        nonce = res.nonce;\n        // once you have nonce (card type, card number) send nonce as 'paymentMethodNonce'\n        // and also total to be charged\n        // console.log(\n        //     \"send nonce and total to process: \",\n        //     nonce,\n        //     getTotal(products)\n        // );\n        const paymentData = {\n          paymentMethodNonce: nonce,\n          amount: getTotal(products)\n        };\n\n        processPayment(userId, token, paymentData)\n          .then(response => {\n            // console.log(response);\n            setData({ ...data, success: response.success });\n            // create order\n            const createOrderData = {\n              products: products,\n              transaction_id: response.transaction.id,\n              amount: response.transaction.amount,\n              address: data.address\n            };\n            createOrder(userId, token, createOrderData);\n            // empty cart\n            emptyCart(() => {\n              setRender(!render); // re-render localstorage\n              console.log('payment success and empty cart');\n              setData({ loading: false, success: true });\n            });\n          })\n          .catch(error => {\n            console.log(error);\n            setData({ loading: false });\n          });\n      })\n      .catch(error => {\n        // console.log(\"dropin error: \", error);\n        setData({ ...data, error: error.message });\n      });\n  };\n\n  const handleAddress = e => {\n    setData({ ...data, address: e.target.value });\n  };\n  const showDropIn = () => (\n    <div onBlur={() => setData({ ...data, error: '' })} className=\"w-50 m-auto\">\n      {data.clientToken !== null && products.length > 0 ? (\n        <div>\n          <div className=\"form-group mb-3\">\n            <label className=\"text-muted\">Delivery Address:</label>\n            <textarea\n              className=\"form-control\"\n              placeholder=\"Enter here\"\n              value={data.address}\n              onChange={handleAddress}\n            />\n          </div>\n          <DropIn\n            options={{\n              authorization: data.clientToken,\n              paypal: {\n                flow: 'vault'\n              }\n            }}\n            onInstance={instance => (data.instance = instance)}\n          />\n          <button onClick={buy} className=\"btn btn-success btn-block pt-2\">\n            Pay\n          </button>\n        </div>\n      ) : null}\n    </div>\n  );\n\n  const showError = error => (\n    <div\n      className=\"alert alert-danger\"\n      style={{ display: error ? '' : 'none' }}\n    >\n      {error}\n    </div>\n  );\n\n  const showSuccess = success => (\n    <div\n      className=\"alert alert-info\"\n      style={{ display: success ? '' : 'none' }}\n    >\n      Thanks! Your payment was successful!\n    </div>\n  );\n\n  const showLoading = loading =>\n    loading && (\n      <div className=\"d-flex justify-content-center\">\n        <div className=\"spinner-border\" role=\"status\">\n          <span className=\"sr-only\">Loading...</span>\n        </div>\n      </div>\n    );\n\n  return (\n    <div className=\"container-fluid \">\n      <h2>Total: ${getTotal()}</h2>\n      {showLoading(data.loading)}\n      {showSuccess(data.success)}\n      {showError(data.error)}\n      {showCheckout()}\n    </div>\n  );\n};\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}